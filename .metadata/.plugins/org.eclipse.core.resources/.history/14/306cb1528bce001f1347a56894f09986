package com.ecom.util;

import java.io.UnsupportedEncodingException;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.stereotype.Component;

import jakarta.mail.MessagingException;
import jakarta.mail.internet.MimeMessage;
import jakarta.servlet.http.HttpServletRequest;

@Component
public class CommonUtil {

	@Autowired
	private JavaMailSender mailSender;

	public Boolean sendMail(String url, String recipientEmail) throws UnsupportedEncodingException, MessagingException {

		MimeMessage message = mailSender.createMimeMessage();
		MimeMessageHelper helper = new MimeMessageHelper(message);

		helper.setFrom("chamidukeshikaz@gmail.com", "Shopping App Support Team");
		helper.setTo(recipientEmail);

		String content = "<html>" + "<head>" + "<style>"
				+ "    body { font-family: Arial, sans-serif; color: #333333; }"
				+ "    .email-header { background-color: #4CAF50; color: white; padding: 10px 20px; text-align: center; }"
				+ "    .email-body { margin: 20px; padding: 20px; border: 1px solid #e0e0e0; border-radius: 5px; }"
				+ "    .email-footer { margin-top: 20px; font-size: 12px; color: #888888; text-align: center; }"
				+ "    a { color: #4CAF50; text-decoration: none; font-weight: bold; }" + "</style>" + "</head>"
				+ "<body>" + "    <div class=\"email-header\">" + "        <h1>Password Reset Request</h1>"
				+ "    </div>" + "    <div class=\"email-body\">" + "        <p>Dear User,</p>"
				+ "        <p>We received a request to reset your password for your <strong>Shopping App</strong> account. If you made this request, you can reset your password by clicking the button below:</p>"
				+ "        <p style=\"text-align: center;\">" + "            <a href=\"" + url
				+ "\" style=\"background-color: #4CAF50; color: white; padding: 10px 20px; border-radius: 5px; display: inline-block;\">Reset Password</a>"
				+ "        </p>"
				+ "        <p>If you did not request to reset your password, please ignore this email. Your account is safe, and no changes have been made.</p>"
				+ "        <p>For any assistance, please contact our support team at <a href=\"mailto:support@shoppingapp.com\">support@shoppingapp.com</a>.</p>"
				+ "        <p>Thank you,<br>The Shopping App Team</p>" + "    </div>"
				+ "    <div class=\"email-footer\">"
				+ "        <p>This email was sent to you because a password reset request was initiated for your account. If you believe this was a mistake, please disregard this email.</p>"
				+ "        <p>&copy; 2025 Shopping App. All rights reserved.</p>" + "    </div>" + "</body>"
				+ "</html>";

		helper.setSubject("Reset Your Shopping App Password");
		helper.setText(content, true);
		mailSender.send(message);

		return true;
	}

	public static String generateUrl(HttpServletRequest request) {

		// http://localhost:8080/forgot-password
		String siteUrl = request.getRequestURL().toString();

		return siteUrl.replace(request.getServletPath(), "");

	}

}
